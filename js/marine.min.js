(function() {
  'use strict';

  function Marine() {}

  Marine.prototype.init = function() {
    this.contentPopup();
    this.forceLandscape();
    this.updateViewMode();
    this.setupEvent();
  };

  Marine.prototype.updateViewMode = function() {
    var windowWidth = $(window).width();
    var windowHeight = $(window).height();
    var windowClass = windowWidth > windowHeight ? 'landscape' : 'portrait';

    $('body').removeClass('portrait landscape');
    $('body').addClass(windowClass);
  };

  Marine.prototype.forceLandscape = function() {
    var md = new MobileDetect(window.navigator.userAgent);
    var isTablet = md.tablet();
    if (isTablet) {
      $('html').addClass('page-tablet');
    } else {
      $('html').removeClass('page-tablet');
    }
  };
  
  Marine.prototype.startPlayer = function() {
    var player = '#music-player';
    var playerContainer = '#music-player-container';
    var options = {
      ready: function () {
        $(this).jPlayer('setMedia', {
          title: '',
          mp3: './figures/audios/audio.mp3'
        });
        $(playerContainer).find('.jp-play').trigger('click');
      },
      swfPath: '../vendors/jplayer',
      supplied: 'mp3',
      cssSelectorAncestor: '#music-player-container',
      wmode: 'window',
    };
    $(player).jPlayer(options);
  };

  Marine.prototype.contentPopup = function() {
    var btnClose = '.content-popup .btn-close';
    if ($(btnClose).length) {
      $(btnClose).on('click', function(e) {
        e.preventDefault();

        $(this).parent().hide();
      });
    }
  };

  Marine.prototype.setupEvent = function() {
    $('.learn, .help').on('click', function(){
      $('.learn').removeClass('active');
      $('.help').removeClass('active');
      $(this).addClass('active');
    });

    $('.learn-popup .btn-close, .help-popup .btn-close').on('click', function(){
      $('.learn').removeClass('active');
      $('.help').removeClass('active');
    })

     $(document).on('keypress', '*', function(e) {
        var key = e.charCode ? e.charCode : e.keyCode ? e.keyCode : 0;
        if(key == 13) {
            e.preventDefault();
            $(this).trigger('click');
        }
    });
  }

  $(document).ready(function() {
    var marine = new Marine();
    marine.init();
  });

  $(window).resize(function() {
    var marine = marine || new Marine();
    marine.updateViewMode();
  });

})();
